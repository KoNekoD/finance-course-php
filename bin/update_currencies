#!/usr/bin/env php
<?php

// Для отправки запроса на чужой сервер
use Symfony\Component\HttpClient\HttpClient;

// Для декодирования результата запроса
use Symfony\Component\Serializer\Serializer;
use Symfony\Component\Serializer\Encoder\XmlEncoder;
use Symfony\Component\Serializer\Normalizer\CustomNormalizer;

if (!is_file(dirname(__DIR__).'/vendor/autoload_runtime.php')) {
    throw new LogicException('Symfony Runtime is missing. Try running "composer require symfony/runtime".');
}

require_once dirname(__DIR__).'/vendor/autoload_runtime.php';

return function (array $context) {

    $client = HttpClient::create();

    $normalizer = new CustomNormalizer();
    $xmlEncoder = new XmlEncoder();
    $serializer = new Serializer([$normalizer], [$xmlEncoder]);

    $response = $client->request('GET', 'http://cbr.ru/scripts/XML_daily.asp');
    $currenciesXML = $response->getContent();

    $currencies = $serializer->decode($currenciesXML, 'xml');

    foreach ($currencies as )
};
